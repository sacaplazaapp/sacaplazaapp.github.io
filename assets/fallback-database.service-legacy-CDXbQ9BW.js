!function(){function e(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var s=a.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}System.register(["./index-legacy-ty0RkzGM.js"],function(t,a){"use strict";var s;return{setters:[e=>{s=e.C}],execute:function(){t("default",new class{constructor(){e(this,"initialized",!1),e(this,"flashcardsKey","chess_flashcards"),e(this,"progressKey","chess_progress"),e(this,"nextIdKey","chess_next_id")}async initializeDatabase(){try{if(console.log(`Platform: ${s.getPlatform()}`),"web"!==s.getPlatform())throw new Error("Native SQLite not implemented in fallback service");console.log("Using localStorage fallback for web development"),this.initializeLocalStorage(),this.initialized=!0,console.log("LocalStorage fallback initialized successfully")}catch(e){throw console.error("Error initializing fallback database:",e),e}}initializeLocalStorage(){localStorage.getItem(this.flashcardsKey)||localStorage.setItem(this.flashcardsKey,JSON.stringify([])),localStorage.getItem(this.progressKey)||localStorage.setItem(this.progressKey,JSON.stringify([])),localStorage.getItem(this.nextIdKey)||localStorage.setItem(this.nextIdKey,"1")}getNextId(){const e=parseInt(localStorage.getItem(this.nextIdKey)||"1");return localStorage.setItem(this.nextIdKey,(e+1).toString()),e}checkInitialized(){if(!this.initialized)throw new Error("Database not initialized")}async addFlashcard(e,t,a,s,r="",i="",o=""){this.checkInitialized();const l=JSON.parse(localStorage.getItem(this.flashcardsKey)||"[]"),n=this.getNextId(),c=(new Date).toISOString(),d={id:n,title:e,question:t,comment:a,answer:s,tags:r,fen1:i,fen2:o,created:c,updated:c};return l.push(d),localStorage.setItem(this.flashcardsKey,JSON.stringify(l)),console.log("Flashcard added:",d),n}async getFlashcards(e){this.checkInitialized();const t=JSON.parse(localStorage.getItem(this.flashcardsKey)||"[]");return e?t.filter(t=>t.tags.includes(e)):t.sort((e,t)=>new Date(t.created).getTime()-new Date(e.created).getTime())}async updateFlashcard(e,t,a,s,r,i="",o="",l=""){this.checkInitialized();const n=JSON.parse(localStorage.getItem(this.flashcardsKey)||"[]"),c=n.findIndex(t=>t.id===e);if(-1===c)throw new Error(`Flashcard with id ${e} not found`);n[c]={...n[c],title:t,question:a,comment:s,answer:r,tags:i,fen1:o,fen2:l,updated:(new Date).toISOString()},localStorage.setItem(this.flashcardsKey,JSON.stringify(n))}async deleteFlashcard(e){this.checkInitialized();const t=JSON.parse(localStorage.getItem(this.flashcardsKey)||"[]").filter(t=>t.id!==e);localStorage.setItem(this.flashcardsKey,JSON.stringify(t));const a=JSON.parse(localStorage.getItem(this.progressKey)||"[]").filter(t=>t.flashcard_id!==e);localStorage.setItem(this.progressKey,JSON.stringify(a))}async recordAnswer(e,t){this.checkInitialized();const a=JSON.parse(localStorage.getItem(this.progressKey)||"[]"),s=a.findIndex(t=>t.flashcard_id===e);if(-1!==s)t?a[s].correct_answers++:a[s].incorrect_answers++,a[s].last_reviewed=(new Date).toISOString();else{const s={id:this.getNextId(),flashcard_id:e,correct_answers:t?1:0,incorrect_answers:t?0:1,last_reviewed:(new Date).toISOString()};a.push(s)}localStorage.setItem(this.progressKey,JSON.stringify(a))}async getFlashcardProgress(e){this.checkInitialized();return JSON.parse(localStorage.getItem(this.progressKey)||"[]").find(t=>t.flashcard_id===e)||null}async closeDatabase(){this.initialized=!1,console.log("LocalStorage fallback service closed")}getConnection(){return null}})}}})}();
